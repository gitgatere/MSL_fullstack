# MSL (Mobile Sensor Location) - Full Stack Application

A complete full-stack application for mobile sensor location tracking with a React frontend and FastAPI backend.

## Project Structure

```
MSL/
├── MSL_frontend/          # React TypeScript frontend
├── MSL_python_backend/    # FastAPI backend
├── docker-compose.yml     # Docker compose for local development
└── README.md
```

## Prerequisites

- Docker & Docker Compose (recommended)
- OR Node.js 20+ and Python 3.10+

## Quick Start with Docker Compose

### Local Development

1. Clone the repository and navigate to the root directory:
```bash
cd /path/to/MSL
```

2. Start all services:
```bash
docker-compose up -d
```

3. Access the applications:
   - **Frontend**: http://localhost:5173 (dev mode) or http://localhost:3000 (production)
   - **Backend API**: http://localhost:8000
   - **API Docs**: http://localhost:8000/docs

### Environment Configuration

#### Backend
Copy `.env.example` to `.env` in `MSL_python_backend/`:
```bash
cp MSL_python_backend/.env.example MSL_python_backend/.env
```

Configure these variables:
- `DATABASE_URL`: PostgreSQL connection string
- `ALLOWED_ORIGINS`: Comma-separated list of allowed origins for CORS

#### Frontend
Copy `.env.example` to `.env.local` in `MSL_frontend/`:
```bash
cp MSL_frontend/.env.example MSL_frontend/.env.local
```

Configure:
- `VITE_API_BASE_URL`: Backend API URL

## Local Development (without Docker)

### Backend Setup

```bash
cd MSL_python_backend

# Install dependencies
pipenv install

# Create .env file
cp .env.example .env
# Edit .env with your database configuration

# Start PostgreSQL manually (or use docker run)
docker run -d -e POSTGRES_PASSWORD=password -p 5432:5432 postgres:15-alpine

# Run migrations and start server
pipenv run uvicorn app:app --reload --port 8000
```

### Frontend Setup

```bash
cd MSL_frontend

# Install dependencies
npm install

# Create .env.local
cp .env.example .env.local
# Edit .env.local with backend URL

# Start development server
npm run dev
```

## Deployment

### Docker Images

The project includes Dockerfiles for both frontend and backend. You can build and deploy them to any Docker-compatible service.

**Build Backend Image:**
```bash
cd MSL_python_backend
docker build -t msl-backend:latest .
```

**Build Frontend Image:**
```bash
cd MSL_frontend
docker build -t msl-frontend:latest .
```

### Deployment Services

Recommended platforms for deployment:
- **Railway.app** - Easy Docker deployment with PostgreSQL
- **Render.com** - Free tier available
- **AWS ECS** - Scalable container orchestration
- **Google Cloud Run** - Serverless container deployment
- **Heroku** - (if you have credits)

### Steps for Railway.app (Recommended)

1. Create a Railway project
2. Add PostgreSQL service
3. Create two services:
   - **Backend**: Points to `MSL_python_backend`, expose port 8000
   - **Frontend**: Points to `MSL_frontend`, expose port 3000

4. Set environment variables:
   - Backend: `DATABASE_URL` (auto-generated by Railway), `ALLOWED_ORIGINS`
   - Frontend: `VITE_API_BASE_URL` (use Railway's backend URL)

5. Deploy using Railway's GitHub integration

## API Endpoints

### Health Check
- `GET /health` - Server health status

### Dashboard
- `GET /stats` - Get dashboard statistics (total devices, present devices, etc.)

### Live Scans
- `GET /live?limit=50` - Get recent scan results

### Submit Scan
- `POST /scan` - Submit a new scan for processing

See `http://localhost:8000/docs` for full API documentation (SwaggerUI)

## Development

### Code Structure

**Frontend:**
- `src/components/` - Reusable React components
- `src/pages/` - Page-level components
- `src/api/` - API client
- `src/types/` - TypeScript interfaces
- `src/styles/` - CSS modules and theme

**Backend:**
- `api.py` - API routes and handlers
- `app.py` - FastAPI application setup
- `db.py` - Database models and configuration
- `fingerprint.py` - Signal fingerprinting logic
- `matching.py` - Location matching algorithms
- `learning.py` - Machine learning functions
- `models.py` - Additional data models

## Troubleshooting

### Docker Issues
```bash
# View logs
docker-compose logs -f

# Rebuild images
docker-compose build --no-cache

# Reset everything
docker-compose down -v
```

### Database Connection Issues
- Ensure PostgreSQL is running and accessible
- Check `DATABASE_URL` format
- Verify port 5432 is available

### CORS Errors
- Add frontend URL to backend's `ALLOWED_ORIGINS`
- Restart backend after changing environment variables

## Support

For issues or questions, please check the individual README files in:
- `MSL_frontend/README.md`
- `MSL_python_backend/` (create if needed)

## License

MIT
